<header id="top-header">
  <span class="siteName">
    <a href="/" title="Return to home page">CSE Motors</a>
  </span>
  <div class="user-account-area" id="userAccountArea" style="display: none;">
    <span class="user-greeting">Welcome, <strong id="headerUsername">User</strong></span>
    <a href="/admin/dashboard" class="user-link admin-link" id="adminLink" style="display: none;">Admin Panel</a>
    <a href="/account/details" class="user-link">My Account</a>
    <a href="/cart" class="user-link user-cart" id="headerCartLink">Cart <span id="headerCartCount" class="cart-count">0</span></a>
    <button class="user-logout" id="logoutBtn">Logout</button>
  </div>
</header>

<style>
  #top-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 1rem;
  }

  .user-account-area {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    font-size: 0.95rem;
  }

  .user-greeting {
    color: #333;
  }

  .user-greeting strong {
    color: #0066cc;
    font-weight: 700;
  }

  .user-link {
    color: #0066cc;
    text-decoration: none;
    font-weight: 600;
    padding: 0.5rem 1rem;
    border: 1px solid #0066cc;
    border-radius: 4px;
    transition: all 0.3s ease;
  }

  .user-link:hover {
    background-color: #0066cc;
    color: white;
  }

  .user-link.admin-link {
    background-color: #ff9800;
    border-color: #ff9800;
    color: white;
  }

  .user-link.admin-link:hover {
    background-color: #f57c00;
    border-color: #f57c00;
  }

  .user-logout {
    background-color: #f44336;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }

  .user-logout:hover {
    background-color: #d32f2f;
  }

  @media (max-width: 768px) {
    #top-header {
      flex-direction: column;
      gap: 0.75rem;
      padding: 0.75rem;
    }

    .user-account-area {
      width: 100%;
      flex-direction: column;
      justify-content: center;
      gap: 0.5rem;
    }

    .user-greeting {
      text-align: center;
      font-size: 0.9rem;
    }

    .user-link,
    .user-logout {
      width: 100%;
      padding: 0.75rem 1rem;
      text-align: center;
      font-size: 0.9rem;
    }

    .user-link {
      box-sizing: border-box;
    }

    .user-logout {
      box-sizing: border-box;
    }
  }

  @media (max-width: 480px) {
    #top-header {
      padding: 0.5rem;
      gap: 0.5rem;
    }

    .siteName {
      font-size: 1.2rem;
    }

    .user-greeting {
      font-size: 0.8rem;
    }

    .user-link,
    .user-logout {
      padding: 0.6rem 0.8rem;
      font-size: 0.85rem;
    }
  }
</style>

<script>
  // Check if user is logged in and display username in header
  document.addEventListener('DOMContentLoaded', async function() {
    try {
      const userDataStr = localStorage.getItem('userData')
      const authToken = localStorage.getItem('authToken')
      
      if (userDataStr && authToken) {
        const userData = JSON.parse(userDataStr)
        const userAccountArea = document.getElementById('userAccountArea')
        const headerUsername = document.getElementById('headerUsername')
        
        headerUsername.textContent = userData.username || 'User'
        userAccountArea.style.display = 'flex'
        
        // Show admin link if user is admin
        if (userData.accountType === 'Admin') {
          document.getElementById('adminLink').style.display = 'inline-block'
        }
        
        // update cart count (if API available)
        try {
          if (typeof authenticatedFetch === 'function') {
            const countResp = await authenticatedFetch('/cart/count')
            if (countResp && typeof countResp.count !== 'undefined') {
              const el = document.getElementById('headerCartCount')
              if (el) el.textContent = countResp.count
            }
          }
        } catch (err) {
          // silent fail - header still shows
          console.debug('Cart count not available:', err)
        }

        // Add logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
          localStorage.removeItem('authToken')
          localStorage.removeItem('userData')
          window.location.href = '/'
        })
      }
    } catch (error) {
      console.error('Error loading user data in header:', error)
    }
  })
</script>
