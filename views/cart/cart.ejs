<div class="cart-page" id="cartPage">
  <h1>Your Shopping Cart</h1>

  <% if (!cartItems || cartItems.length === 0) { %>
    <p class="empty-message">Your cart is empty.</p>
  <% } %>

  <div class="cart-grid">
    <section class="cart-items" id="cartItems">
      <% if (cartItems && cartItems.length > 0) { %>
        <% cartItems.forEach(item => { %>
          <article class="cart-item" data-inv-id="<%= item.invId %>">
            <div class="item-thumb">
              <img src="<%= item.image || '/images/vehicles/no-image.png' %>" alt="<%= item.name %>">
            </div>
            <div class="item-info">
              <h3 class="item-name"><%= item.name %></h3>
              <p class="item-price">$<%= Number(item.price).toFixed(2) %></p>
              <form class="qty-form" action="/cart/update-session" method="POST">
                <input type="hidden" name="invId" value="<%= item.invId %>" />
                <div class="qty-controls">
                  <button type="button" class="qty-btn" data-action="decrease">âˆ’</button>
                  <input class="qty-input" type="number" name="quantity" value="<%= item.quantity %>" min="1" max="99" />
                  <button type="button" class="qty-btn" data-action="increase">+</button>
                </div>
                <button class="visually-hidden" type="submit">Update</button>
              </form>
              <form class="remove-form" action="/cart/remove-session" method="POST">
                <input type="hidden" name="invId" value="<%= item.invId %>" />
                <button class="remove-btn" type="submit">Remove</button>
              </form>
            </div>
          </article>
        <% }) %>
      <% } %>
    </section>

    <aside class="cart-summary" id="cartSummary">
      <% let subtotal = 0; if (cartItems) { cartItems.forEach(i => { subtotal += Number(i.price) * Number(i.quantity) }) } %>
      <div class="summary-card">
        <h3>Order Summary</h3>
        <p>Subtotal: <strong id="subtotal">$<%= subtotal ? subtotal.toFixed(2) : '0.00' %></strong></p>
        <p>Tax (<span id="taxRate">8.875%</span>): <strong id="tax">$0.00</strong></p>
        <p class="total">Total: <strong id="total">$0.00</strong></p>
        <div class="summary-actions">
          <a href="/inv" class="btn continue-shopping-btn" id="continueShoppingBtn">Continue Shopping</a>
          <a href="/account/login" class="btn checkout-btn" id="checkoutBtn">Checkout</a>
        </div>
      </div>
    </aside>
  </div>
</div>

<link rel="stylesheet" href="/css/styles.css">

<script>
  // Expose initial session cart to client JS
  window.__sessionCart = <%- JSON.stringify(cartItems || []) %>;
</script>

<style>
  /* Cart page specific styling */
  .cart-grid {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 1.5rem;
    align-items: start;
    max-width: 1100px;
    margin: 1.5rem auto;
  }

  .cart-items { background: #fff; padding: 1rem; border-radius: 8px; border: 1px solid rgba(0,0,0,0.06); }
  .cart-item { display: flex; gap: 1rem; padding: .75rem 0; border-bottom: 1px solid #eee; }
  .cart-item:last-child { border-bottom: none; }
  .item-thumb img { width: 140px; height: 90px; object-fit: cover; border-radius: 6px; }
  .item-info { flex: 1; display: flex; flex-direction: column; gap: .5rem; }
  .item-name { margin: 0; font-size: 1.05rem; }
  .item-price { color: var(--main-accent); font-weight: 700; }

  .qty-controls { display: inline-flex; align-items: center; gap: .5rem; }
  .qty-btn { background: #f4f6f8; border: 1px solid #ddd; padding: .25rem .6rem; border-radius: 4px; cursor: pointer; }
  .qty-input { width: 60px; text-align: center; padding: .25rem; border: 1px solid #ddd; border-radius: 4px; }

  .remove-btn { background: transparent; border: 1px solid #f44336; color: #f44336; padding: .4rem .6rem; border-radius: 6px; cursor: pointer; }

  .cart-summary { position: sticky; top: 1.5rem; }
  .summary-card { background: #fbfbff; padding: 1rem; border-radius: 8px; border: 1px solid rgba(0,0,0,0.06); }
  .summary-card h3 { margin-top: 0; }
  .summary-card p { margin: .5rem 0; font-size: 1rem; }
  .summary-card .total { font-size: 1.15rem; margin-top: .75rem; }
  .summary-actions { display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem; }
  .checkout-btn { display: inline-block; width: 100%; padding: .75rem; background: var(--main-accent); color: #fff; text-align: center; border-radius: 6px; text-decoration: none; font-weight: 700; }
  .continue-shopping-btn { display: inline-block; width: 100%; padding: .75rem; background: #6c757d; color: #fff; text-align: center; border-radius: 6px; text-decoration: none; font-weight: 700; }
  .continue-shopping-btn:hover { background: #5a6268; }

  @media (max-width: 900px) {
    .cart-grid { grid-template-columns: 1fr; }
    .item-thumb img { width: 120px; height: 75px; }
  }
</style>

<script defer src="/js/cart.js"></script>