<h1><%= title %></h1>

<% if (typeof messages !== 'undefined' && messages.length) { %>
  <% messages.forEach(msg => { %>
    <div class="alert alert-<%= msg.type === 'success' ? 'success' : 'error' %>" role="alert">
      <%= msg.message %>
    </div>
  <% }) %>
<% } %>

<% if (flashMessage) { %>
  <div class="message <%= messageType || 'info' %>">
    <%= flashMessage %>
  </div>
<% } %>

<div class="management-actions">
  <div class="action-buttons">
    <a href="/inv/add-classification" class="btn btn-primary" id="addClassificationBtn" style="display:none;">+ Add New Classification</a>
    <a href="/inv/add-inventory" class="btn btn-primary" id="addInventoryBtn" style="display:none;">+ Add New Vehicle</a>
    <a href="/inv/" class="btn btn-secondary">View Full Inventory</a>
  </div>
</div>
<script>
  // Only show admin buttons for Admin users
  const userDataStr = localStorage.getItem('userData')
  if (userDataStr) {
    try {
      const userData = JSON.parse(userDataStr)
      if (userData.accountType === 'Admin') {
        document.getElementById('addClassificationBtn').style.display = 'inline-block'
        document.getElementById('addInventoryBtn').style.display = 'inline-block'
      }
    } catch (e) {
      console.error('Error parsing user data:', e)
    }
  }
</script>

<h2>Current Inventory</h2>

<% if (inventory && inventory.length) { %>
  <div class="table-responsive">
    <table class="management-table">
      <thead>
        <tr>
          <th>Year</th>
          <th>Make</th>
          <th>Model</th>
          <th>Classification</th>
          <th>Price</th>
          <th>Miles</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% inventory.forEach(item => { %>
          <tr>
            <td><%= item.inv_year %></td>
            <td><%= item.inv_make %></td>
            <td><%= item.inv_model %></td>
            <td><span class="badge"><%= item.classification_name %></span></td>
            <td>$<%= new Intl.NumberFormat("en-US").format(item.inv_price) %></td>
            <td><%= new Intl.NumberFormat("en-US").format(item.inv_miles) %></td>
            <td>
              <div class="action-links">
                <a href="/inv/detail/<%= item.inv_id %>" class="link-btn view" title="View details">View</a>
                <a href="/inv/edit/<%= item.inv_id %>" class="link-btn edit" title="Edit vehicle">Edit</a>
                <a href="/inv/delete/<%= item.inv_id %>" class="link-btn delete" title="Delete vehicle" onclick="return confirm('Are you sure you want to delete this vehicle?');">Delete</a>
              </div>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  
  <p class="inventory-count">Total vehicles: <%= inventory.length %></p>
<% } else { %>
  <p class="notice">No inventory items found. <a href="/inv/add-inventory" id="addFirstVehicleLink" style="display:none;">Add your first vehicle</a></p>
<% } %>

<script>
  // Show add first vehicle link only for admins
  const userDataStr = localStorage.getItem('userData')
  if (userDataStr) {
    try {
      const userData = JSON.parse(userDataStr)
      if (userData.accountType === 'Admin') {
        const link = document.getElementById('addFirstVehicleLink')
        if (link) link.style.display = 'inline'
      }
    } catch (e) {
      console.error('Error parsing user data:', e)
    }
  }
</script>

