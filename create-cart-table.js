const { Pool } = require('pg')
require('dotenv').config()

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: { rejectUnauthorized: false }
})

async function createCartTable() {
  try {
    console.log('Creating cart table...')
    
    const sql = `
      CREATE TABLE IF NOT EXISTS public.cart (
        cart_id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
        account_id integer NOT NULL,
        inv_id integer NOT NULL,
        cart_quantity integer NOT NULL DEFAULT 1,
        cart_unit_price numeric(9,2) NOT NULL,
        created_at timestamp with time zone DEFAULT now(),
        CONSTRAINT cart_pkey PRIMARY KEY (cart_id),
        CONSTRAINT fk_cart_account FOREIGN KEY (account_id) REFERENCES public.account (account_id) ON DELETE CASCADE,
        CONSTRAINT fk_cart_inventory FOREIGN KEY (inv_id) REFERENCES public.inventory (inv_id) ON DELETE CASCADE,
        CONSTRAINT cart_account_inv_unique UNIQUE (account_id, inv_id)
      )
    `
    
    await pool.query(sql)
    console.log('âœ“ Cart table created successfully!')
    
    await pool.end()
  } catch (error) {
    console.error('Error creating cart table:', error.message)
    process.exit(1)
  }
}

createCartTable()
